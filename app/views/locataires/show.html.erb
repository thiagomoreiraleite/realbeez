<% unless @locataire.statut == "annulé" %>
  <% if current_user.admin == true || @locataire.user_id == current_user.id || @locataire.annonce.user_id == current_user.id || @locataire.annonce.agent_user_id.to_i == current_user.id %>
    <div class="d-flex align-items-center justify-content-center mb-5 picture-mobile" style="height: 60vh; background-size: cover; background-position: center; background-image:linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.1)), url('<%= cl_image_path "https://res.cloudinary.com/dvfwroq5k/#{Locataire.find(params[:id].to_i).annonce.photo.identifier}" %>')">
      <div >
        <p style="color:white; font-family: simply rounded; font-size: 26px" class="text-center mb-3 px-2"><%= Locataire.find(params[:id].to_i).annonce.titre_annonce %></p>
      </div>
    </div>
    <h3 class="text-center mt-5 mb-4">Dossier de location
      <% if @locataire.user_id == current_user.id && @locataire.statut_proprietaire == "En cours"%>
        <span class="ml-3" style="font-size: 14px">
          <%= link_to '', edit_locataire_path(@locataire), class:"fas fa-edit" %> /
          <%= link_to '', locataire_path(@locataire), method: :delete, data: { confirm: 'Êtes-vous sûr de vouloir supprimer ce dossier de location?'}, class:"fas fa-trash"  %>
        </span>
      <% end %>
    </h3>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12 col-md-6 col-lg-6">
          <p class="mt-4" >Dossier déposé par un agent : <%= @locataire.agent %></p>
          <p class="mt-4 border-top pt-3" style="color: #D8A727; font-weight: bold">LE LOCATAIRE PRINCIPAL</p>
          <p><strong>Prénom</strong> : <%= @locataire.prenom %></p>
          <p><strong>Nom</strong> : <%= @locataire.nom %></p>
          <p><strong>Adresse</strong> : <%= @locataire.adresse %></p>
          <p><strong>Ville</strong> : <%= @locataire.ville %></p>
          <p><strong>Téléphone</strong> : <%= @locataire.tel %></p>
          <p><strong>Email</strong> : <%= @locataire.email %></p>
          <p class="mb-2"><strong>Carte d'identité / Passeport : </strong></p>
          <div class="d-flex align-items-center">
            Recto :
            <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.id_recto.filename}", :target => "_blank",class: "btn btn-transparent mx-2" %>
            <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.id_recto.filename}", :target => "_blank",class: "btn btn-transparent" %>
          </div>
          <div class="d-flex align-items-center">
            Verso :
            <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.id_verso.filename}", :target => "_blank",class: "btn btn-transparent mx-2 mt-2" %>
            <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.id_verso.filename}", :target => "_blank",class: "btn btn-transparent mt-2" %>
          </div>
          <p class="mt-3 mb-2"><strong>Justificatif de domicile</strong> : </p>
          <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.justif_dom.filename}", :target => "_blank",class: "btn btn-transparent mr-1" %>
          <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.justif_dom.filename}", :target => "_blank",class: "btn btn-transparent" %>
          <p class="mb-2 mt-3"><strong>3 dernières fiches de paye </strong> : </p>
          <div class="d-flex align-items-center">
            Mois m-1 :
            <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.fiche_paye_mois1.filename}", :target => "_blank",class: "btn btn-transparent mx-2" %>
            <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.fiche_paye_mois1.filename}", :target => "_blank",class: "btn btn-transparent" %>
          </div>
          <div class="d-flex align-items-center">
            Mois m-2 :
            <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.fiche_paye_mois2.filename}", :target => "_blank",class: "btn btn-transparent mx-2 mt-2" %>
            <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.fiche_paye_mois2.filename}", :target => "_blank",class: "btn btn-transparent mt-2" %>
          </div>
          <div class="d-flex align-items-center">
            Mois m-3 :
            <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.fiche_paye_mois3.filename}", :target => "_blank",class: "btn btn-transparent mx-2 mt-2" %>
            <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.fiche_paye_mois3.filename}", :target => "_blank",class: "btn btn-transparent mt-2" %>
          </div>
          <p class="mt-3 mb-2"><strong>Contrat de travail</strong> : </p>
          <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.contrat.filename}", :target => "_blank",class: "btn btn-transparent mr-1" %>
          <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.contrat.filename}", :target => "_blank",class: "btn btn-transparent" %>
          <p class="mt-5 border-top pt-3" style="color: #D8A727; font-weight: bold">LE GARANT (caution solidaire)</p>
          <p><strong>Prénom</strong> : <%= @locataire.prenom_garant %></p>
          <p><strong>Nom</strong> : <%= @locataire.nom_garant %></p>
          <p><strong>Adresse</strong> : <%= @locataire.adresse_garant %></p>
          <p><strong>Ville</strong> : <%= @locataire.ville_garant %></p>
          <p><strong>Téléphone</strong> : <%= @locataire.tel_garant %></p>
          <p><strong>Email</strong> : <%= @locataire.email_garant %></p>
          <p class="mb-2"><strong>Carte d'identité / Passeport</strong> : </p>
          <div class="d-flex align-items-center">
            Recto :
            <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.id_recto_garant.filename}", :target => "_blank",class: "btn btn-transparent mx-2" %>
            <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.id_recto_garant.filename}", :target => "_blank",class: "btn btn-transparent" %>
          </div>
          <div class="d-flex align-items-center">
            Verso :
            <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.id_verso_garant.filename}", :target => "_blank",class: "btn btn-transparent mx-2 mt-2" %>
            <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.id_verso_garant.filename}", :target => "_blank",class: "btn btn-transparent mt-2" %>
          </div>
          <p class="mt-3 mb-2"><strong>Justificatif de domicile</strong> : </p>
          <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.justif_dom_garant.filename}", :target => "_blank",class: "btn btn-transparent mr-1" %>
          <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.justif_dom_garant.filename}", :target => "_blank",class: "btn btn-transparent" %>
          <p class="mb-2 mt-3"><strong>3 dernières fiches de paye</strong> : </p>
          <div class="d-flex align-items-center">
            Mois m-1 :
            <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.fiche_paye_mois1_garant.filename}", :target => "_blank",class: "btn btn-transparent mx-2" %>
            <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.fiche_paye_mois1_garant.filename}", :target => "_blank",class: "btn btn-transparent" %>
          </div>
          <div class="d-flex align-items-center">
            Mois m-2 :
            <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.fiche_paye_mois2_garant.filename}", :target => "_blank",class: "btn btn-transparent mx-2 mt-2" %>
            <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.fiche_paye_mois2_garant.filename}", :target => "_blank",class: "btn btn-transparent mt-2" %>
          </div>
          <div class="d-flex align-items-center">
            Mois m-3 :
            <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.fiche_paye_mois3_garant.filename}", :target => "_blank",class: "btn btn-transparent mx-2 mt-2" %>
            <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.fiche_paye_mois3_garant.filename}", :target => "_blank",class: "btn btn-transparent mt-2" %>
          </div>
          <p class="mt-3 mb-2"><strong>Contrat de travail</strong> : </p>
          <%= link_to "Ouvrir", "https://res.cloudinary.com/dvfwroq5k/image/upload/#{@locataire.contrat_garant.filename}", :target => "_blank",class: "btn btn-transparent mr-1" %>
          <%= link_to "Télécharger", "https://res.cloudinary.com/dvfwroq5k/image/upload/fl_attachment/#{@locataire.contrat_garant.filename}", :target => "_blank",class: "btn btn-transparent" %>
          <p class="mt-3 border-top pt-3"><strong>Message</strong> : <%= @locataire.message == nil || @locataire.message == "" ? "Aucun" : @locataire.message  %></p>
          <!-- Agent to validate that documents are complete -->
          <!--   <p class="mt-4 border-top pt-3" style="color: #D8A727; font-weight: bold">Reservé à l'agent : Valider que le dossier de location est complet</p>
      <p><strong>Statut : </strong><%#= @locataire.statut_agent == nil || @locataire.statut_agent == "" ? "En cours" : @locataire.statut_agent %></p> -->
          <!-- Proprio to give his decision : approve or reject -->
          <p class="mt-4 border-top pt-3" style="color: #D8A727; font-weight: bold">Reservé au propriétaire : Accepte ou Refuse le dossier de location</p>
          <% if @locataire.annonce.user_id == current_user.id %>
            <%= link_to "Accepter" , accept_locataire_path(@locataire), method: :post, data: { confirm: "Etes-vous sûr d'accepter le dossier de candidature?" }, class: "btn btn-yellow-mustard" %>
            <%= link_to "Rejeter", reject_locataire_path(@locataire), method: :post, data: { confirm: 'Etes-vous sûr de vouloir rejeter le dossier de candidature?'}, class: "btn btn-danger" %>
          <% end %>
          <p class="mb-5 mt-3"><strong>Statut</strong> : <%= @locataire.statut_proprietaire == nil || @locataire.statut_proprietaire == "" ? "En cours" : @locataire.statut_proprietaire %></p>
        </div>
      </div>
    </div>
  <% else %>
    <h4 class="text-center mt-5" style="width: 100%; color:#DA334A; font-style: italic">"Vous n'avez pas accès à cette page"</h4>
  <% end %>
<% else %>
  <h4 class="text-center mt-5" style="width: 100%; color:#DA334A; font-style: italic">"Dossier supprimé"</h4>
<% end %>